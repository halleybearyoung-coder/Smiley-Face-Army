<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smiley Face Dev</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, onSnapshot, collection, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- Global Config & Variables ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "DEFAULT", authDomain: "DEFAULT", projectId: "DEFAULT" };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId;
        let filesCollection;
        let currentFileId = null;
        let activeFileButton = null;
        let currentPreviewUrl = null; 

        // --- NEW: GitHub Variables ---
        let githubToken = null;
        let githubUser = null;
        let currentGithubFile = {
            owner: null,
            repo: null,
            path: null,
            sha: null
        };

        // --- Get UI Elements ---
        const codeEditor = document.getElementById('codeEditor');
        const saveBtn = document.getElementById('saveBtn');
        const previewBtn = document.getElementById('previewBtn');
        const previewFrame = document.getElementById('previewFrame');
        const fileList = document.getElementById('file-list');
        const newFileBtn = document.getElementById('new-file-btn');
        const statusIndicator = document.getElementById('status-indicator');
        const newFileInput = document.getElementById('new-file-input');
        const newFileConfirmBtn = document.getElementById('new-file-confirm-btn');

        // --- NEW: Tab & GitHub UI Elements ---
        const tabFirebase = document.getElementById('tab-firebase');
        const tabGithub = document.getElementById('tab-github');
        const panelFirebase = document.getElementById('panel-firebase');
        const panelGithub = document.getElementById('panel-github');
        const githubConnectBtn = document.getElementById('github-connect-btn');
        const githubTokenInput = document.getElementById('github-token-input');
        const githubConnectModal = document.getElementById('github-connect-modal');
        const githubCancelBtn = document.getElementById('github-cancel-btn');
        const githubConfirmBtn = document.getElementById('github-confirm-btn');
        const githubErrorMsg = document.getElementById('github-error-msg');
        const githubAuthView = document.getElementById('github-auth-view');
        const githubDataView = document.getElementById('github-data-view');
        const githubAvatar = document.getElementById('github-avatar');
        const githubUsername = document.getElementById('github-username');
        const githubRepoOwner = document.getElementById('github-repo-owner');
        const githubRepoName = document.getElementById('github-repo-name');
        const githubLoadRepoBtn = document.getElementById('github-load-repo-btn');
        const githubFileList = document.getElementById('github-file-list');
        const githubSaveBtn = document.getElementById('github-save-btn');
        // --- NEW: GitHub New File Elements ---
        const githubNewFileBtn = document.getElementById('github-new-file-btn');
        const githubNewFileInput = document.getElementById('github-new-file-input');
        const githubNewFileConfirmBtn = document.getElementById('github-new-file-confirm-btn');
        const githubNewFileControls = document.getElementById('github-new-file-controls');


        // --- Helper Function ---
        function showStatus(message, isError = false) {
            statusIndicator.textContent = message;
            statusIndicator.classList.toggle('text-green-400', !isError);
            statusIndicator.classList.toggle('text-red-400', isError);
            setTimeout(() => statusIndicator.textContent = '', 3000);
        }

        // --- NEW: Tab Switching ---
        tabFirebase.addEventListener('click', () => {
            tabFirebase.classList.add('bg-stone-700');
            tabGithub.classList.remove('bg-stone-700');
            panelFirebase.classList.remove('hidden');
            panelGithub.classList.add('hidden');
        });

        tabGithub.addEventListener('click', () => {
            tabGithub.classList.add('bg-stone-700');
            tabFirebase.classList.remove('bg-stone-700');
            panelGithub.classList.remove('hidden');
            panelFirebase.classList.add('hidden');
        });


        // --- NEW: GitHub Functions ---
        
        // Show/Hide the connection modal
        githubConnectBtn.addEventListener('click', () => githubConnectModal.classList.remove('hidden'));
        githubCancelBtn.addEventListener('click', () => githubConnectModal.classList.add('hidden'));

        // --- NEW: GitHub New File Button Listeners ---
        githubNewFileBtn.addEventListener('click', () => {
            // Toggle the new file input box
            githubNewFileControls.classList.toggle('hidden');
            if (!githubNewFileControls.classList.contains('hidden')) {
                githubNewFileInput.focus();
            }
        });

        githubNewFileConfirmBtn.addEventListener('click', async () => {
            const owner = githubRepoOwner.value;
            const repo = githubRepoName.value;
            const path = githubNewFileInput.value.trim();

            if (!owner || !repo || !path || !githubToken) {
                showStatus("Owner, repo, or new filename is missing.", true);
                return;
            }

            // Create some default content for the new file
            const newContent = `<!-- New file created by Smiley Face Dev: ${path} -->\n`;
            
            // Encode content robustly
            const encoder = new TextEncoder();
            const data = encoder.encode(newContent);
            let binaryStringEnc = '';
            for (let i = 0; i < data.length; i++) {
                binaryStringEnc += String.fromCharCode(data[i]);
            }
            const encodedContent = btoa(binaryStringEnc);

            showStatus("Creating new file in GitHub...");

            try {
                const encodedOwner = encodeURIComponent(owner);
                const encodedRepo = encodeURIComponent(repo);
                const encodedPath = path.split('/').map(encodeURIComponent).join('/');

                const response = await fetch(`https://api.github.com/repos/${encodedOwner}/${encodedRepo}/contents/${encodedPath}`, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `Bearer ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Commit from Smiley Face Dev: Create ${path}`,
                        content: encodedContent
                        // No SHA is provided, which tells GitHub to create a new file
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => null); 
                    const errorMsg = errorData?.message || response.statusText;
                    // Handle "file already exists"
                    if (response.status === 422 && errorMsg.includes("sha")) {
                         throw new Error(`File already exists: ${path}`);
                    }
                    throw new Error(`GitHub Error ${response.status}: ${errorMsg}`);
                }

                // Success!
                showStatus("New file created in GitHub!");
                githubNewFileInput.value = '';
                githubNewFileControls.classList.add('hidden');
                
                // Refresh the file list to show the new file
                // --- FIX: Call the new function directly instead of .click() ---
                await loadGithubRepoFiles(); 
                // --- END FIX ---

            } catch (err) {
                console.error("GitHub New File Error:", err);
                showStatus(err.message, true);
            }
        });
        // --- END NEW LISTENERS ---

        // Connect to GitHub
        githubConfirmBtn.addEventListener('click', async () => {
            const token = githubTokenInput.value;
            if (!token) {
                githubErrorMsg.textContent = "Please enter a token.";
                return;
            }

            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error('Invalid token or API error.');
                }

                githubUser = await response.json();
                githubToken = token;

                // Update UI
                githubUsername.textContent = githubUser.login;
                githubAvatar.src = githubUser.avatar_url;
                githubAuthView.classList.add('hidden');
                githubDataView.classList.remove('hidden');
                githubConnectModal.classList.add('hidden');
                githubErrorMsg.textContent = '';
                githubTokenInput.value = '';

            } catch (err) {
                console.error("GitHub Connection Error:", err);
                githubErrorMsg.textContent = err.message;
            }
        });

        // Load Repo Files
        // --- FIX: Changed this to just call the new function ---
        githubLoadRepoBtn.addEventListener('click', loadGithubRepoFiles);
        // --- END FIX ---

        // --- NEW: Extracted file loading logic into its own function ---
        async function loadGithubRepoFiles() {
            const owner = githubRepoOwner.value;
            const repo = githubRepoName.value;
            if (!owner || !repo || !githubToken) {
                showStatus("Missing owner, repo, or token.", true);
                return;
            }

            githubFileList.innerHTML = '<p class="text-stone-400">Loading files...</p>';
            
            try {
                // --- FIX: URL-encode the owner and repo names ---
                const encodedOwner = encodeURIComponent(owner);
                const encodedRepo = encodeURIComponent(repo);

                const response = await fetch(`https://api.github.com/repos/${encodedOwner}/${encodedRepo}/contents/`, {
                // --- END FIX ---
                    headers: { 'Authorization': `Bearer ${githubToken}` }
                });
                
                if (!response.ok) throw new Error("Repo not found or access denied.");
                
                const files = await response.json();
                githubFileList.innerHTML = ''; // Clear loading message

                if (files.length === 0) {
                     githubFileList.innerHTML = '<p class="text-stone-400">Repo is empty.</p>';
                     return;
                }

                files.forEach(file => {
                    // Only show files, not directories for this simple editor
                    if (file.type === 'file') {
                        const fileEl = document.createElement('button');
                        fileEl.textContent = file.path;
                        fileEl.className = 'block w-full text-left p-2 rounded hover:bg-stone-700 truncate';
                        fileEl.onclick = () => {
                            // Pass the original, un-encoded names
                            loadGithubFile(owner, repo, file.path, file.sha);
                        };
                        githubFileList.appendChild(fileEl);
                    }
                });
            } catch (err) {
                console.error("GitHub Repo Load Error:", err);
                githubFileList.innerHTML = `<p class="text-red-400">${err.message}</p>`;
            }
        }
        // --- END NEW FUNCTION ---

        // Load a specific file
        async function loadGithubFile(owner, repo, path, sha) {
            try {
                // --- FIX: URL-encode owner and repo names ---
                const encodedOwner = encodeURIComponent(owner);
                const encodedRepo = encodeURIComponent(repo);
                
                const response = await fetch(`https://api.github.com/repos/${encodedOwner}/${encodedRepo}/git/blobs/${sha}`, {
                // --- END FIX ---
                     headers: { 'Authorization': `Bearer ${githubToken}` }
                });

                if (!response.ok) throw new Error("Could not fetch file content.");

                const blobData = await response.json();
                
                if (blobData.encoding !== 'base64') {
                    throw new Error("Cannot load non-text (not base64) file.");
                }

                // Decode base64 content
                // --- FIX: Use TextDecoder for robust UTF-8 decoding ---
                const binaryString = atob(blobData.content);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                const decoder = new TextDecoder(); // Default is 'utf-8'
                const fileContent = decoder.decode(bytes);
                // --- END FIX ---
                
                codeEditor.value = fileContent;

                // Save file info for saving later
                currentGithubFile = { owner, repo, path, sha };
                currentFileId = null; // Unselect Firebase file
                
                // Show the "Save to GitHub" button
                githubSaveBtn.classList.remove('hidden');
                
                // Reset Firebase save button state
                saveBtn.classList.add('bg-stone-500', 'cursor-not-allowed');
                saveBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                if(activeFileButton) activeFileButton.classList.remove('bg-blue-600');
                activeFileButton = null;


            } catch (err) {
                console.error("GitHub File Load Error:", err);
                showStatus(err.message, true);
            }
        }

        // Save file to GitHub
        githubSaveBtn.addEventListener('click', async () => {
            const { owner, repo, path, sha } = currentGithubFile;
            if (!owner || !repo || !path || !sha) {
                showStatus("No GitHub file is open.", true);
                return;
            }

            const newContent = codeEditor.value;
            // Content must be base64 encoded for the API
            // --- FIX: Use TextEncoder for robust UTF-8 encoding ---
            const encoder = new TextEncoder();
            const data = encoder.encode(newContent); // This is a Uint8Array
            // Convert Uint8Array to a binary string
            let binaryStringEnc = '';
            for (let i = 0; i < data.length; i++) {
                binaryStringEnc += String.fromCharCode(data[i]);
            }
            const encodedContent = btoa(binaryStringEnc);
            // --- END FIX ---

            showStatus("Saving to GitHub...");

            try {
                // --- FIX: URL-encode owner, repo, and path ---
                const encodedOwner = encodeURIComponent(owner);
                const encodedRepo = encodeURIComponent(repo);
                // For the path, we encode each part *except* the slashes
                const encodedPath = path.split('/').map(encodeURIComponent).join('/');

                const response = await fetch(`https://api.github.com/repos/${encodedOwner}/${encodedRepo}/contents/${encodedPath}`, {
                // --- END FIX ---
                    method: 'PUT',
                    headers: { 
                        'Authorization': `Bearer ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Commit from Smiley Face Dev: ${path}`,
                        content: encodedContent,
                        sha: sha // This is CRITICAL. It proves we are updating the latest version.
                    })
                });

                if (!response.ok) {
                    // --- FIX: Better Error Handling ---
                    // Try to get a more specific error message from GitHub
                    const errorData = await response.json().catch(() => null); 
                    const errorMsg = errorData?.message || response.statusText;
                    throw new Error(`GitHub Error ${response.status}: ${errorMsg}`);
                    // --- END FIX ---
                }

                const data = await response.json();
                
                // IMPORTANT: Update the SHA to the new commit SHA
                currentGithubFile.sha = data.content.sha;

                showStatus("File saved to GitHub!");

            } catch (err) {
                console.error("GitHub Save Error:", err);
                showStatus(err.message, true);
            }
        });


        // --- Firebase Functions ---

        // MOVED: onAuthStateChanged was moved to the init block to fix auth error

        // New File Button
        newFileBtn.addEventListener('click', () => {
            newFileInput.classList.toggle('hidden');
            newFileConfirmBtn.classList.toggle('hidden');
        });

        // Confirm New File
        newFileConfirmBtn.addEventListener('click', async () => {
            const fileName = newFileInput.value.trim();
            if (fileName && filesCollection) {
                try {
                    await addDoc(filesCollection, {
                        name: fileName,
                        content: `<!-- New File: ${fileName} -->`,
                        createdAt: serverTimestamp()
                    });
                    newFileInput.value = '';
                    newFileInput.classList.add('hidden');
                    newFileConfirmBtn.classList.add('hidden');
                    showStatus("File created!");
                } catch (err) {
                    console.error("Error creating file:", err);
                    showStatus("Error creating file.", true);
                }
            }
        });

        // Save Code Button (Firebase)
        saveBtn.addEventListener('click', async () => {
            if (!currentFileId) {
                showStatus("No Firebase file selected.", true);
                return;
            }
            
            showStatus("Saving to Firebase...");
            try {
                const fileRef = doc(db, 'artifacts', appId, 'users', userId, 'files', currentFileId);
                await setDoc(fileRef, { 
                    content: codeEditor.value 
                }, { merge: true });
                showStatus("Saved to Firebase!");
            } catch (err) {
                console.error("Error saving file:", err);
                showStatus("Error saving file.", true);
            }
        });

        // Preview Code Button
        previewBtn.addEventListener('click', () => {
            const code = codeEditor.value;
            
            // --- INJECT config variables ---
            const configString = JSON.stringify(firebaseConfig);
            const idString = JSON.stringify(appId);
            const tokenString = auth.currentUser ? JSON.stringify(auth.currentUser.uid) : "'undefined'";
            
            const injectionScript = `
<script>
    var __firebase_config = ${configString};
    var __app_id = ${idString};
    var __initial_auth_token = ${tokenString};
<\/script>
`;
            const finalCode = injectionScript + code;
            
            if (currentPreviewUrl) {
                URL.revokeObjectURL(currentPreviewUrl);
            }
            const blob = new Blob([finalCode], { type: 'text/html' });
            currentPreviewUrl = URL.createObjectURL(blob);
            previewFrame.src = currentPreviewUrl;
        });

        // --- Initialize App ---
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            
            // --- MOVED onAuthStateChanged HERE ---
            // This fixes the error by ensuring 'auth' is defined before being used.
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    filesCollection = collection(db, 'artifacts', appId, 'users', userId, 'files');
                    
                    // Start listening for file changes
                    onSnapshot(query(filesCollection), (snapshot) => {
                        fileList.innerHTML = ''; // Clear list
                        snapshot.forEach((doc) => {
                            const file = doc.data();
                            const fileEl = document.createElement('button');
                            fileEl.id = doc.id;
                            fileEl.textContent = file.name;
                            fileEl.className = 'block w-full text-left p-2 rounded hover:bg-stone-700 truncate';
                            
                            fileEl.addEventListener('click', () => {
                                // Reset GitHub button
                                githubSaveBtn.classList.add('hidden');
                                currentGithubFile = { owner: null, repo: null, path: null, sha: null };

                                // Set active Firebase button
                                if (activeFileButton) {
                                    activeFileButton.classList.remove('bg-blue-600');
                                }
                                activeFileButton = fileEl;
                                activeFileButton.classList.add('bg-blue-600');

                                currentFileId = doc.id;
                                codeEditor.value = file.content;
                                saveBtn.classList.remove('bg-stone-500', 'cursor-not-allowed');
                                saveBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                            });
                            fileList.appendChild(fileEl);
                        });
                    });
                }
            });
            // --- END MOVED BLOCK ---

            // Sign in
            if (initialAuthToken) {
                // We're inside an iframe with a token (e.g., the preview)
                // This auth method is not standard, so we'll just use anonymous
                // Note: The *real* auth token injection is for the *preview*,
                // not the editor itself. The editor signs in normally.
                await signInAnonymously(auth);
            } else {
                // We are the main editor, sign in anonymously
                await signInAnonymously(auth);
            }
        } catch (err) {
            console.error("Firebase Init Error:", err);
            document.body.innerHTML = "Error initializing. Check console.";
        }
    </script>
</head>
<body class="bg-stone-900 text-stone-200 h-screen flex flex-col">

    <!-- Header -->
    <header class="flex items-center justify-between p-2 bg-stone-800 border-b border-stone-700">
        <h1 class="text-xl font-bold text-yellow-400">Smiley Face Dev</h1>
        <div>
            <span id="status-indicator" class="text-sm text-green-400 mr-4"></span>
            
            <!-- NEW: Save to GitHub Button (starts hidden) -->
            <button id="github-save-btn" class="hidden px-4 py-2 bg-purple-600 text-white rounded shadow hover:bg-purple-700 mr-2">
                Save to GitHub
            </button>
            
            <button id="saveBtn" class="px-4 py-2 bg-stone-500 text-white rounded shadow cursor-not-allowed mr-2">
                Save
            </button>
            <button id="previewBtn" class="px-4 py-2 bg-blue-500 text-white rounded shadow hover:bg-blue-600">
                Preview
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden">
        
        <!-- Left Panel: Files -->
        <div class="w-1/4 h-full flex flex-col bg-stone-800 border-r border-stone-700">
            <!-- NEW: Tab Navigation -->
            <div class="flex border-b border-stone-700">
                <button id="tab-firebase" class="flex-1 p-2 text-center text-sm font-medium bg-stone-700">Firebase</button>
                <button id="tab-github" class="flex-1 p-2 text-center text-sm font-medium hover:bg-stone-700">GitHub</button>
            </div>

            <!-- Panel 1: Firebase (default) -->
            <div id="panel-firebase" class="flex-1 flex flex-col p-2 overflow-y-auto">
                <div id="file-list" class="flex-1 space-y-1">
                    <!-- File buttons will be injected by JS -->
                </div>
                <div class="mt-2">
                    <input id="new-file-input" type="text" placeholder="new-file.html" class="hidden w-full p-2 bg-stone-700 rounded mb-1 text-sm">
                    <button id="new-file-confirm-btn" class="hidden w-full p-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">Confirm</button>
                    <button id="new-file-btn" class="w-full p-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">+ New File</button>
                </div>
            </div>

            <!-- Panel 2: GitHub (hidden) -->
            <div id="panel-github" class="hidden flex-1 flex flex-col p-2 overflow-y-auto">
                <!-- View 1: Not Connected -->
                <div id="github-auth-view">
                    <p class="text-sm text-stone-400 mb-2">Connect to GitHub to load and save files from your repositories.</p>
                    <button id="github-connect-btn" class="w-full p-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm">
                        Connect to GitHub
                    </button>
                </div>
                <!-- View 2: Connected -->
                <div id="github-data-view" class="hidden">
                    <div class="flex items-center p-2 bg-stone-700 rounded mb-4">
                        <img id="github-avatar" src="" alt="avatar" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium">Logged in as <strong id="github-username"></strong></span>
                    </div>
                    <div class="space-y-2">
                        <div>
                            <label for="github-repo-owner" class="text-sm font-medium">Owner</label>
                            <!-- UPDATED: More helpful placeholder -->
                            <input id="github-repo-owner" type="text" placeholder="Your GitHub Username (e.g., 'octocat')" class="w-full p-2 bg-stone-700 rounded mt-1 text-sm">
                        </div>
                        <div>
                            <label for="github-repo-name" class="text-sm font-medium">Repo</label>
                            <!-- UPDATED: More helpful placeholder -->
                            <input id="github-repo-name" type="text" placeholder="Your Repo Name (e.g., 'Spoon-Knife')" class="w-full p-2 bg-stone-700 rounded mt-1 text-sm">
                        </div>
                        <button id="github-load-repo-btn" class="w-full p-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">Load Repo Files</button>
                        
                        <!-- --- NEW: GitHub New File Button & Inputs --- -->
                        <button id="github-new-file-btn" class="w-full p-2 mt-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm">+ New GitHub File</button>
                        <div id="github-new-file-controls" class="hidden mt-2 space-y-1">
                            <input id="github-new-file-input" type="text" placeholder="path/to/new-file.html" class="w-full p-2 bg-stone-700 rounded text-sm">
                            <button id="github-new-file-confirm-btn" class="w-full p-2 bg-green-700 text-white rounded hover:bg-green-800 text-sm">Confirm Create</button>
                        </div>
                        <!-- --- END NEW --- -->
                    
                    </div>
                    <div id="github-file-list" class="flex-1 space-y-1 mt-4 p-2 bg-stone-900 rounded h-48 overflow-y-auto">
                        <!-- GitHub file list appears here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Panel: Editor & Preview -->
        <div class="w-3/4 h-full flex flex-col">
            <!-- Code Editor -->
            <div class="h-1/2 w-full">
                <textarea 
                    id="codeEditor" 
                    class="w-full h-full p-4 bg-stone-950 text-green-400 font-mono text-sm border-b border-stone-700 outline-none resize-none" 
                    placeholder="<!-- Your code here... -->"
                ></textarea>
            </div>
            
            <!-- Preview Window (iframe) -->
            <div class="h-1/2 w-full bg-white">
                <iframe 
                    id="previewFrame" 
                    title="Code Preview"
                    class="w-full h-full"
                    sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-modals"
                ></iframe>
            </div>
        </div>
    </main>

    <!-- NEW: GitHub Connect Modal -->
    <div id="github-connect-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center">
        <div class="bg-stone-800 p-6 rounded-lg shadow-xl w-full max-w-md">
            <h2 class="text-lg font-medium mb-4">Connect to GitHub</h2>
            <p class="text-sm text-stone-400 mb-2">
                Generate a <a href="https://github.com/settings/tokens/new?scopes=repo" target="_blank" class="text-blue-400 underline">Personal Access Token</a>
                with <strong class="text-yellow-400">`repo`</strong> scope.
            </p>
            <p class="text-xs text-red-400 mb-4">WARNING: This is insecure and for dev purposes only. Your token is stored in the browser.</p>
            <input id="github-token-input" type="password" placeholder="ghp_..." class="w-full p-2 bg-stone-700 rounded mb-2 text-sm">
            <p id="github-error-msg" class="text-red-400 text-sm mb-4 h-5"></p>
            <div class="flex justify-end gap-2">
                <button id="github-cancel-btn" class="px-4 py-2 bg-stone-600 rounded hover:bg-stone-700">Cancel</button>
                <button id="github-confirm-btn" class="px-4 py-2 bg-purple-600 rounded hover:bg-purple-700">Connect</button>
            </div>
        </div>
    </div>

</body>
</html>
